---
title: "Introducción"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{introduccion}
  %\VignetteEncoding{UTF-8}
  %\VignetteEngine{knitr::rmarkdown}
editor_options: 
  chunk_output_type: console
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
library(magrittr)
library(siabox)
library(dplyr)

# Este código es para que funcionen los ejemplos de abajo, por ahora no es
# necesario entenderlo para quien quiere aprender a usar el paquete:
d <- filtrar_datos(datos_sia, id_programa = 3, id_parametro = 2098, 
                   rango_fechas = 2019, tipo_punto_id = 1L) %>% 
  dplyr::select(nro_muestra, pt = valor, 
                ld = limite_deteccion, 
                lc = limite_cuantificacion)

```

# siabox

Se trata de un paquete con algunas `data.frames` (o mejor dicho, [tibble](https://tibble.tidyverse.org/)s) que han sido importadas directamente del SIA, así como algunas funciones para trabajar o graficar con estos datos.

Como usuarios del SIA, normalmente usamos los datos para gráficas, análisis, reportes y más. En este proceso, si usamos R, vamos a generar procedimientos o scripts, que muchas veces son utilizados una única vez.

**Sería ideal que estos scripts, funciones, etc, puedan ser usados en muchas instancias y por diferentes personas, de forma que se unifiquen y compartan fácilmente distintos métodos para procesar los datos.**

Más aún, estos códigos R **se podrían incorporar al motor de las aplicaciónes Shiny del SIA** (especialmente, iSIA y hSIA)

Esta es la motivación de fondo para crear este paquete. 

De todas formas, es importante aclarar que el mismo no presenta métodos para automatizar este proceso, ni mucho menos. En cambio, se enfoca en unificar el formato en que se presentan los datos. El objetivo es facilitar la **compatibilidad** entre desarrollos de diferentes personas.

La idea es que, si todos los scripts y funciones que creamos parten del mismo lugar, entonces hay muchas más chances de que se puedan reutilizar. De hecho, eventualmente todos los usuarios de R/SIA pueden ser colaboradores del desarrollo de este paquete...

## Compatibilidad? 

Para entender la idea de _compatibilidad_ entre distintos códigos R, puede ser útil un ejemplo sencillo. Supongamos que Dorotea está trabajando con datos del SIA descargados en excel. Importó el fósforo total para santa lucía y editó los datos de forma que:

- La `data.frame` se llama `d`
- La columna (3) con los valores se llama `pt`
- Las columnas (4 y 5) con los límites de detección y cuantificación se llaman `ld` y `lc` respectivamente.
- Debido a que no le interesaba la columna 2 (nombre del programa), simplemente la borró

```{r dorotea.data.frame, eval=FALSE}
d <- readxl::read_excel("archivo.xls")
names(d)[3:5] <- c("pt", "ld", "lc")
d <- d[-2]
```

Uno de los cálculos que hizo es el de IET, con este código:

```{r dorotea.iet}
d$iet <- 10 * (6 - (0.42 - 0.36 * log(d$pt)) / log(2)) - 20
hist(d$iet, main = "Distribución del IET", ylab = "Conteo", xlab = "IET")
```

Ahora, supongamos que Segismundo también desarrolló código R para calcular el
IET, y se ve así:

```{r Segismundo.iet, eval=FALSE}
d <- readxl::read_excel("StaLucia_PT_2019.xls")
names(d)[3:5] <- c("PT", "LD", "LC")

d[[6]] <- 10 * (6 - (0.42 - 0.36 * log(d[[3]])) / log(2)) - 20
hist(d[[6]], main = "Distribución", ylab = "Densidad", freq = TRUE,
     xlab = "Índice de Estado Trófico")
```

```{r Segismundo.backend, echo=FALSE}
d <- tibble::add_column(d, Programa = "Santa Lucía", .after = 1)
d <- d[1:5]
names(d)[3:5] <- c("PT", "LD", "LC")
d$IET <- iet(d$PT)
hist(d$IET, main = "Distribución", ylab = "Densidad", freq = FALSE,
     xlab = "Índice de Estado Trófico")
```



es que esos scripts generados se puedan aprovechar más, convirtiéndolos 


```{r setup}
# library(siabox)

```
