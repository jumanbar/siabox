% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/basicas.R
\name{consulta_muestras}
\alias{consulta_muestras}
\title{Consultar muestras de parámetros de infambiental}
\usage{
consulta_muestras(
  con,
  id_matriz = 6L,
  id_programa = NULL,
  id_cuenca = NULL,
  id_sub_cuenca = NULL,
  id_estacion = NULL,
  id_tipo_punto = NULL,
  id_depto = NULL,
  id_parametro = NULL,
  id_institucion = NULL,
  usuario = NULL,
  anios = NULL,
  meses = NULL,
  fecha_ini = "1900-01-01",
  fecha_fin = Sys.Date()
)
}
\arguments{
\item{con}{\code{PostgreSQLConnection}: objeto utilizado para conectarse con la
base de datos. Ver details.}

\item{id_matriz}{integer. Valor único. Número de matriz.}

\item{id_programa}{integer. Vector con números id de programas. Si es \code{NULL}
(valor por defecto), selecciona todos los programas.}

\item{id_cuenca}{integer. Vector con números de cuenca.}

\item{id_sub_cuenca}{integer. Vector con números de subcuenca.}

\item{id_estacion}{Integer. Vector con números id de estaciones. Si es \code{NULL}
(valor por defecto), selecciona todas las estaciones.}

\item{id_tipo_punto}{integer. Vector con números que identifican el tipo de
punto (1. SUPERFICIE, 2. FONDO).}

\item{id_depto}{Integer. Vector con números id de departamentos. Si es \code{NULL}
(valor por defecto), selecciona todos los departamentos.}

\item{id_parametro}{integer. Vector con números id de parámetros. Si es
\code{NULL} (valor por defecto), selecciona todos los parámetros.}

\item{id_institucion}{integer. Vector con números id de instituciones. Si es
\code{NULL} (valor por defecto), selecciona todas las instituciones.}

\item{usuario}{character. Vector con nombres de usuarios encontrados en los
datos. Ej.: 'jmartinez'.}

\item{anios}{integer. Vector con los años para los que se quiere filtrar el
conjunto de datos. Ej.: 2017:2019.}

\item{meses}{integer. Vector con los números de meses para los que se quiere       filtrar el conjunto de datos. Ej.: 6:12.}

\item{fecha_ini}{\code{character}. Fecha en formato \code{AAAA-MM-DD}.}

\item{fecha_fin}{\code{character}. Fecha en formato \code{AAAA-MM-DD}.}
}
\value{
Una \code{tibble}, en formato largo, con las columnas:
\itemize{

\item id_muestra: \code{integer} id único de cada muestra

\item nro_muestra: \code{integer} nro único de para muestra provenientes del SILAD

\item id_estado: \code{integer} id que identifica el "estado" del dato: 1.
pendiente, 2. original, 3. aprobado

\item nombre_programa \code{character} nombre de cada programa

\item id_programa: \code{integer} id único de cada programa

\item cue_nombre: \code{character} nombre de la cuenca

\item id_cuenca: \code{integer} id único de la cuenca

\item sub_cue_nombre: \code{character} nombre de la subcuenca

\item id_sub_cuenca: \code{integer} id único de la subcuenca

\item codigo_pto: \code{character} nombre de cada estación

\item id_estacion: \code{integer} id único de cada estación

\item tipo_punto_id: \code{integer} id único del tipo de punto

\item tip_pun_est_descripcion: \code{character} descripción del tipo de punto

\item id_depto: \code{integer} id único del departamento

\item departamento: \code{character} nombre del departamento

\item id_institucion: \code{integer} id único de la institución

\item institucion: \code{character} nombre de la institución que cargó el dato en
el SIA

\item usuario: \code{character} nombre de usuario que cargó el dato en el SIA

\item periodo: \code{character} asignación de mes y año para cada campaña de
muestreo.

\item anio: \code{character} año en que fue tomada la muestra

\item mes: \code{character} mes en que fue tomada la muestra

\item anio_mes: \code{character} año+mes en que fue tomada la muestra

\item fecha_muestra: \code{Date} fecha en que fue tomada la muestra

\item fecha_hora: \code{character} fecha y hora en que fue tomada la muestra, en
formato "yyyy-mm-dd HH:MM:SS"

\item observaciones: \code{character} observaciones para el dato

\item id_matriz: \code{integer} id único de la matriz

\item id_parametro: \code{integer} id único de cada parámetro

\item parametro: \code{character} nombre extendido del parámetro

\item nombre_clave: \code{character} código único del parámetro

\item id_unidad: \code{integer} id único de las unidades de medida

\item uni_nombre: \code{character} notación de las unidades de medida

\item valor_minimo_str: \code{character} con el valor ingresado para el parámetro

\item limite_deteccion: \code{character} con el valor del límite de detección
ingresado para el parámetro

\item limite_cuantificacion: \code{character} con el valor del límite de
cuantificación ingresado para el parámetro

}
}
\description{
Trae datos de infambiental a través de una PostgreSQLConnection. Es el método
utilizado por las aplicaciones shiny. Normalmente en vez de usar esta
función, se usa el set \code{\link{datos_sia}}, que ya tiene datos extraidos
y preparados para ensayar ejemplos.
}
\details{
El parámetro \code{con} es un objeto utilizado para realizar la conexión
con la base de datos. Específicamente, es llamado por la función
DBI::dbGetQuery. La creación del objeto normalmente se hace al iniciar el
servidor shiny de una aplicación (en el archivo \code{global.R}
correspondiente), cuyo código está basado en \href{https://tinyurl.com/yfl9kvol}{este ejemplo}.

Los parámetros con el prefijo \code{id_} refieren al número de id presente en la
base de datos del SIA infambientalbd.

Eliminación de datos repetidos:

En la base de datos original, hay algunos datos que se pueden encontrar
repetidos, debido a que cuando se hacen sucesivos cambios, se mantienen los
valores originales.

Una de estas situaciones es cuando cambia el id_estado: 1. pendiente, 2.
original, 3. aprobado. En caso de encontrar un par id_muestra x
id_parametro repetidos, la función elije aquel que tenga id_estado mayor.

En caso de que lo anterior no sea suficiente para desambigüar, se usa el id
más reciente de la tabla \code{datos_muestra_parametros} y se descarta el resto.
}
\examples{
\dontrun{
# ConexiÃ³n con la base de datos:
con <- DBI::dbConnect(RPostgres::Postgres(), dbname = "infambientalbd",
                      host = "172.20.0.34", port = 5432,
                      user = "shiny_usr", password = "shiny_passwd")

# Todas las muestras de todos los programas en el aÃ±o 2019:
consulta_muestras(con, fecha_ini = "2019-12-24", fecha_fin = "2019-12-31")
consulta_muestras(con, id_programa = 1L,
                  id_estacion = c(100054L, 100061L, 100063L, 100172L),
                  id_parametro = c(2009L, 2020L),
                  fecha_ini = "2017-10-31", fecha_fin = "2019-10-31")
}
}
\seealso{
\code{\link{sia_datos_muestra_parametros}},
\code{\link{sia_muestra}}, \code{\link{clasif_tipo_dato}},
\code{\link{valores_numericos}},
\code{\link{sia_datos_muestra_parametros}},
\code{\link{sia_datos_muestra_parametros}}
}
